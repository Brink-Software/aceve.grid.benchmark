<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blazorise Grid - 10K Rows Benchmark</title>
    <base href="/" />
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Blazorise CSS -->
    <link href="_content/Blazorise/blazorise.css" rel="stylesheet" />
    <link href="_content/Blazorise.Bootstrap5/blazorise.bootstrap5.css" rel="stylesheet" />
    
    <!-- Custom CSS -->
    <link href="css/app.css" rel="stylesheet" />
  </head>

  <body>
    <div id="app">
      <div
        style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
        "
      >
        <div
          style="
            font-size: 24px;
            color: #0d6efd;
            font-weight: bold;
            margin-bottom: 20px;
          "
        >
          Blazorise Grid Laden...
        </div>
        <div style="width: 100px; height: 100px; margin: 0 auto">
          <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <div style="margin-top: 20px; color: #666; font-size: 14px">
          Blazor WebAssembly wordt geÃ¯nitialiseerd...
        </div>
      </div>
    </div>

    <div id="blazor-error-ui">
      An unhandled error has occurred.
      <a href="" class="reload">Reload</a>
      <a class="dismiss">ðŸ—™</a>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Blazorise JS -->
    <script src="_content/Blazorise/blazorise.js"></script>
    <script src="_content/Blazorise.Bootstrap5/blazorise.bootstrap5.js"></script>
    
    <!-- Blazor -->
    <script src="_framework/blazor.webassembly.js"></script>
    
    <script>
      // Performance measurement helpers
      window.gridPerformance = {
        marks: {},
        
        // Start a performance measurement
        startMeasure: function(name) {
          const markName = `${name}-start`;
          performance.mark(markName);
          this.marks[name] = markName;
          console.log(`â±ï¸ Started measuring: ${name}`);
        },
        
        // Stop measurement and return elapsed time
        stopMeasure: function(name) {
          const startMark = this.marks[name];
          if (!startMark) {
            console.warn(`No start mark found for: ${name}`);
            return 0;
          }
          
          const endMark = `${name}-end`;
          performance.mark(endMark);
          
          const measureName = `${name}-measure`;
          performance.measure(measureName, startMark, endMark);
          
          const entries = performance.getEntriesByName(measureName);
          const duration = entries.length > 0 ? entries[0].duration : 0;
          
          console.log(`â±ï¸ ${name}: ${duration.toFixed(2)} ms`);
          
          // Cleanup
          delete this.marks[name];
          
          return duration;
        },
        
        // Wait for grid to be rendered (checks for grid element and rows)
        waitForGridRender: async function(gridId, maxWaitMs = 10000) {
          const startTime = performance.now();
          
          return new Promise((resolve, reject) => {
            let checkCount = 0;
            const maxChecks = maxWaitMs / 50; // Check every 50ms
            
            const checkGrid = () => {
              checkCount++;
              
              const grid = document.getElementById(gridId);
              if (!grid) {
                if (checkCount >= maxChecks) {
                  reject(new Error('Grid element not found'));
                  return;
                }
                setTimeout(checkGrid, 50);
                return;
              }
              
              // Check if grid has rendered rows (Blazorise uses table-row class)
              const rows = grid.querySelectorAll('tr.table-row, tbody tr');
              
              if (rows.length > 0) {
                // Wait one more frame to ensure render is complete
                requestAnimationFrame(() => {
                  const elapsed = performance.now() - startTime;
                  console.log(`âœ… Grid rendered with ${rows.length} visible rows in ${elapsed.toFixed(2)} ms`);
                  resolve(elapsed);
                });
              } else {
                if (checkCount >= maxChecks) {
                  reject(new Error('Grid rows not rendered within timeout'));
                  return;
                }
                setTimeout(checkGrid, 50);
              }
            };
            
            // Start checking after a short delay to let Blazor start rendering
            setTimeout(checkGrid, 50);
          });
        },
        
        // Get memory usage (if available)
        getMemoryUsage: function() {
          if (performance.memory) {
            return {
              usedJSHeapSize: performance.memory.usedJSHeapSize,
              totalJSHeapSize: performance.memory.totalJSHeapSize,
              jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
            };
          }
          return null;
        }
      };
      
      // Show performance indicator
      window.showPerformanceIndicator = function(operation, time, dataTest) {
        // Performance indicator is now handled by Blazor component
        console.log(`ðŸ“Š Performance: ${operation} - ${time}`);
      };
      
      console.log('ðŸš€ Grid Performance Measurement Ready');
    </script>
  </body>
</html>

