<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AG Grid - 200.000 Rijen, 500 Kolommen met CRUD</title>
    <!-- Fluent UI CSS -->
    <link
      rel="stylesheet"
      href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-core/11.0.0/css/fabric.min.css"
    />
    <link rel="stylesheet" href="styles.css" />
    <!-- AG Grid Community CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-grid.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-theme-alpine.css"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ¢ AG Grid - 200.000 Rijen, 500 Kolommen</h1>
        <p>
          Met Row Grouping en CRUD functionaliteit (Toevoegen, Bewerken,
          Verwijderen)
        </p>
      </header>

      <div class="toolbar">
        <div class="toolbar-info">
          <span class="info-badge" data-test="info-badge-medewerkers"
            >ğŸ“Š
            <span id="totalEmployees" data-test="total-employees">0</span>
            Medewerkers</span
          >
          <span class="info-badge" data-test="info-badge-afdelingen"
            >ğŸ¢
            <span id="totalDepartments" data-test="total-departments">0</span>
            Afdelingen</span
          >
          <span class="info-badge" data-test="info-badge-teams"
            >ğŸ‘¥
            <span id="totalTeams" data-test="total-teams">0</span> Teams</span
          >
        </div>
        <div class="toolbar-actions">
          <button
            id="addRowBtn"
            class="btn-primary"
            disabled
            title="Selecteer eerst een rij of groep om een nieuwe rij toe te voegen"
            data-test="nieuw-rij-toevoegen"
          >
            â• Nieuwe Rij Toevoegen
          </button>
          <button
            id="expandAllBtn"
            class="btn-secondary"
            data-test="alles-uitklappen"
          >
            ğŸ“‚ Alles Uitklappen
          </button>
          <button
            id="collapseAllBtn"
            class="btn-secondary"
            data-test="alles-inklappen"
          >
            ğŸ“ Alles Inklappen
          </button>
          <button
            id="deleteRowsBtn"
            class="btn-danger"
            disabled
            data-test="verwijderen-geselecteerde"
          >
            ğŸ—‘ï¸ Verwijder Geselecteerde (<span
              id="selectedCount"
              data-test="selected-count"
              >0</span
            >)
          </button>
        </div>
      </div>

      <div class="info-panel">
        <p>
          <strong>ğŸ’¡ Tips:</strong> Dubbelklik op een cel om te bewerken |
          Selecteer rijen en klik op "Verwijder Geselecteerde" | Gebruik "Nieuwe
          Rij Toevoegen" om een rij toe te voegen
        </p>
      </div>

      <div class="grid-container" data-test="grid-container">
        <!-- Loading Spinner -->
        <div
          id="loadingSpinner"
          class="loading-spinner"
          data-test="loading-spinner"
        >
          <div class="spinner"></div>
          <p class="loading-text">
            Data wordt gegenereerd...<br /><span
              id="loadingProgress"
              data-test="loading-progress"
              >0</span
            >
            rijen
          </p>
        </div>
        <div
          id="myGrid"
          class="ag-theme-alpine"
          style="display: none"
          data-test="ag-grid"
        ></div>
      </div>
    </div>

    <!-- AG Grid Community JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
    <!-- AG Grid Enterprise JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-enterprise@31.0.0/dist/ag-grid-enterprise.min.js"></script>
    <script>
      // Verify Enterprise loaded before app script
      (function checkEnterpriseLoaded() {
        if (typeof window.agGrid === "undefined") {
          console.log("Wachten op AG Grid Community...");
          setTimeout(checkEnterpriseLoaded, 100);
          return;
        }
        
        const agGrid = window.agGrid;
        let enterpriseLoaded = false;
        
        if (agGrid.EnterpriseModule) {
          enterpriseLoaded = true;
          console.log("âœ“ AG Grid Enterprise geladen (EnterpriseModule)");
        } else if (agGrid.LicenseManager) {
          enterpriseLoaded = true;
          console.log("âœ“ AG Grid Enterprise geladen (LicenseManager)");
        } else {
          console.warn("âš  AG Grid Enterprise nog niet gedetecteerd, wachten...");
          setTimeout(checkEnterpriseLoaded, 200);
          return;
        }
        
        // Enterprise is loaded, now load the app
        console.log("âœ“ Alle AG Grid modules geladen, start applicatie...");
        const script = document.createElement("script");
        script.type = "module";
        script.src = "../dist/Ag-grid/src/ag-grid-app.js";
        document.body.appendChild(script);
      })();
      
      // Error handler voor module loading
      window.addEventListener("error", function (e) {
        if (e.filename && (e.filename.includes("ag-grid-app.js") || e.filename.includes("app.js") || e.filename.includes("data.js"))) {
          console.error("Module loading error:", e.message);
          console.error("File:", e.filename);
          console.error("Line:", e.lineno);
          console.error("Full error:", e);
        }
      });

      // Check of module geladen is - verhoog timeout voor grote modules
      let checkCount = 0;
      const checkInterval = setInterval(function () {
        checkCount++;
        if (typeof window.gridOptions !== "undefined") {
          console.log("âœ“ Module succesvol geladen na " + (checkCount * 500) + "ms");
          clearInterval(checkInterval);
        } else if (checkCount >= 10) {
          // Na 5 seconden
          console.warn("Waarschuwing: gridOptions niet gevonden na 5 seconden");
          console.log("Controleer browser console voor foutmeldingen");
          console.log("Mogelijke oorzaken:");
          console.log("1. Module path incorrect");
          console.log("2. Import errors (check console voor 'Failed to load module')");
          console.log("3. JavaScript errors in module");
          clearInterval(checkInterval);
        }
      }, 500);
    </script>
  </body>
</html>
