<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MudBlazor Grid - 1K Rows Benchmark</title>
    <base href="/" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
  </head>

  <body>
    <div id="app">
      <div
        style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          text-align: center;
        "
      >
        <div
          style="
            font-size: 24px;
            color: #594ae2;
            font-weight: bold;
            margin-bottom: 20px;
          "
        >
          MudBlazor Grid Laden...
        </div>
        <div style="width: 100px; height: 100px; margin: 0 auto">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
            <circle
              cx="50"
              cy="50"
              r="40"
              stroke="#594AE2"
              stroke-width="8"
              fill="none"
              stroke-dasharray="160"
              stroke-dashoffset="0"
              style="animation: spin 1.5s linear infinite"
            >
              <animate
                attributeName="stroke-dashoffset"
                from="0"
                to="251"
                dur="1.5s"
                repeatCount="indefinite"
              />
            </circle>
          </svg>
        </div>
        <div style="margin-top: 20px; color: #666; font-size: 14px">
          Blazor WebAssembly wordt geÃ¯nitialiseerd...
        </div>
      </div>
    </div>

    <div id="blazor-error-ui">
      An unhandled error has occurred.
      <a href="" class="reload">Reload</a>
      <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
    
    <script>
      // Performance measurement helpers
      window.gridPerformance = {
        marks: {},
        
        // Start a performance measurement
        startMeasure: function(name) {
          const markName = `${name}-start`;
          performance.mark(markName);
          this.marks[name] = markName;
          console.log(`â±ï¸ Started measuring: ${name}`);
        },
        
        // Stop measurement and return elapsed time
        stopMeasure: function(name) {
          const startMark = this.marks[name];
          if (!startMark) {
            console.warn(`No start mark found for: ${name}`);
            return 0;
          }
          
          const endMark = `${name}-end`;
          performance.mark(endMark);
          
          const measureName = `${name}-measure`;
          performance.measure(measureName, startMark, endMark);
          
          const entries = performance.getEntriesByName(measureName);
          const duration = entries.length > 0 ? entries[0].duration : 0;
          
          console.log(`â±ï¸ ${name}: ${duration.toFixed(2)} ms`);
          
          // Cleanup
          delete this.marks[name];
          
          return duration;
        },
        
        // Wait for grid to be rendered (checks for grid element and rows)
        waitForGridRender: async function(gridId, maxWaitMs = 10000) {
          const startTime = performance.now();
          
          return new Promise((resolve, reject) => {
            let checkCount = 0;
            const maxChecks = maxWaitMs / 50; // Check every 50ms
            
            const checkGrid = () => {
              checkCount++;
              
              const grid = document.getElementById(gridId);
              if (!grid) {
                if (checkCount >= maxChecks) {
                  reject(new Error('Grid element not found'));
                  return;
                }
                setTimeout(checkGrid, 50);
                return;
              }
              
              // Check if grid has rendered rows
              const rows = grid.querySelectorAll('tr[class*="mud-table-row"]');
              
              if (rows.length > 0) {
                // Wait one more frame to ensure render is complete
                requestAnimationFrame(() => {
                  const elapsed = performance.now() - startTime;
                  console.log(`âœ… Grid rendered with ${rows.length} rows in ${elapsed.toFixed(2)} ms`);
                  resolve(elapsed);
                });
              } else {
                if (checkCount >= maxChecks) {
                  reject(new Error('Grid rows not rendered within timeout'));
                  return;
                }
                setTimeout(checkGrid, 50);
              }
            };
            
            // Start checking after a short delay to let Blazor start rendering
            setTimeout(checkGrid, 50);
          });
        },
        
        // Get memory usage (if available)
        getMemoryUsage: function() {
          if (performance.memory) {
            return {
              usedJSHeapSize: performance.memory.usedJSHeapSize,
              totalJSHeapSize: performance.memory.totalJSHeapSize,
              jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
            };
          }
          return null;
        }
      };
      
      console.log('ðŸš€ Grid Performance Measurement Ready');
    </script>
  </body>
</html>
